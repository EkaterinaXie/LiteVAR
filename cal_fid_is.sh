#!/bin/bash
# echo "all original"
# echo " MODE 0 "
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 0 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/m0q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi



# echo "threshold 0.95"
# # echo "MODE 1 "
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0 --threshold 0.95 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.95/m1q0.txt
# # if [ $? -ne 0 ]; then
# #     echo "failed"
# # fi
# echo "MODE 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0 --threshold 0.95 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.95/m2q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi


# echo "threshold 0.90"
# # echo "MODE 1 "
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0 --threshold 0.90 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.9/m1q0.txt
# # if [ $? -ne 0 ]; then
# #     echo "failed"
# # fi
# echo "MODE 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0 --threshold 0.90 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.9/m2q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi


# echo "threshold 0.85"
# # echo "MODE 1 "
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0 --threshold 0.85 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.85/m1q0.txt
# # if [ $? -ne 0 ]; then
# #     echo "failed"
# # fi
# echo "MODE 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0 --threshold 0.85 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.85/m2q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi


# echo "threshold 0.80"
# echo "MODE 1 "
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0 --threshold 0.80 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.8/m1q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi
# echo "MODE 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0 --threshold 0.80 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.8/m2q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi


# echo "threshold 0.70"
# # echo "MODE 1 "
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0 --threshold 0.70 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.7/m1q0.txt
# # if [ $? -ne 0 ]; then
# #     echo "failed"
# # fi
# echo "MODE 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0 --threshold 0.70 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.7/m2q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi


# echo "threshold 0.60"
# # echo "MODE 1 "
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0 --threshold 0.60 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.6/m1q0.txt
# # if [ $? -ne 0 ]; then
# #     echo "failed"
# # fi
# echo "MODE 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "7," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0 --threshold 0.60 > /share/public/diffusion_quant/xierui/pythonprogram/VAR/experiments_new/log/img_score_txt/seed_0/fid/threshold_0.6/m2q0.txt
# if [ $? -ne 0 ]; then
#     echo "failed"
# fi





# echo "################# MODE 0 "
# # echo "Running m0q0"
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 0
# # if [ $? -ne 0 ]; then
# #     echo "m0q0 failed"
# # fi

# echo "m0q0 finished, running m0q1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m0q1 failed"
# fi

# echo "m0q1 finished, running m0q2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 2
# if [ $? -ne 0 ]; then
#     echo "m0q2 failed"
# fi

# echo "m0q2 finished, running m0q3"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m0q3 failed"
# fi

# echo "m0q3 finished, running m0q4"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m0q4 failed"
# fi

# echo "m0q4 finished, running m0q5"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 5
# if [ $? -ne 0 ]; then
#     echo "m0q5 failed"
# fi

# echo "m0q5 finished, running m0q10"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 10
# if [ $? -ne 0 ]; then
#     echo "m0q10 failed"
# fi
# echo "m0q10 finished"


# echo "################# MODE 1 "
# # echo "Running m1q0"
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0
# # if [ $? -ne 0 ]; then
# #     echo "m1q0 failed"
# # fi

# echo "m1q0 finished, running m1q1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m1q1 failed"
# fi

# echo "m1q1 finished, running m1q2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 2
# if [ $? -ne 0 ]; then
#     echo "m1q2 failed"
# fi

# echo "m1q2 finished, running m1q3"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m1q3 failed"
# fi

# echo "m1q3 finished, running m1q4"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m1q4 failed"
# fi

# echo "m0q5 finished, running m1q5"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 5
# if [ $? -ne 0 ]; then
#     echo "m1q5 failed"
# fi

# echo "m0q5 finished, running m1q10"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 10
# if [ $? -ne 0 ]; then
#     echo "m1q10 failed"
# fi
# echo "m1q10 finished"
# ########################################
# echo "################# MODE 2"
# # echo "Running m2q0"
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0
# # if [ $? -ne 0 ]; then
# #     echo "m2q0 failed"
# # fi

# echo "m2q0 finished, running m2q1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m2q1 failed"
# fi

# echo "m2q1 finished, running m2q2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 2
# if [ $? -ne 0 ]; then
#     echo "m2q2 failed"
# fi

# echo "m2q2 finished, running m2q3"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m2q3 failed"
# fi

# echo "m0q5 finished, running m2q4"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m2q4 failed"
# fi

# echo "m0q5 finished, running m2q5"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 5
# if [ $? -ne 0 ]; then
#     echo "m2q5 failed"
# fi

# echo "m0q5 finished, running m2q10"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 10
# if [ $? -ne 0 ]; then
#     echo "m2q10 failed"
# fi
# echo "m2q10 finished"
# echo "finish all"

##################################################################################################################################################################### mix percision
# echo "QUANT 1: W8A8"
# echo "begin mode 0"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m0q1 failed"
# fi
# echo "begin mode 1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m1q1 failed"
# fi

# echo "begin mode 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m2q1 failed"
# fi

# echo "QUANT 3: W6A6"
# echo "begin mode 0"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m0q3 failed"
# fi
# echo "begin mode 1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m1q3 failed"
# fi
# echo "begin mode 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m2q3 failed"
# fi


# echo "QUANT 4: W4A8"
# echo "begin mode 0"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m0q4 failed"
# fi
# echo "begin mode 1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m1q4 failed"
# fi
# echo "begin mode 2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "2," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m2q4 failed"
# fi
# echo "fid and is of mix-percision is finished"

# strict layer

echo "MODE 0 W8A8 & W4A4"
echo "strict layer -- word_embed"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "word_embed"
if [ $? -ne 0 ]; then
    echo "word_embed failed"
fi
echo "strict layer -- attn.mat_qkv"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "attn.mat_qkv"
if [ $? -ne 0 ]; then
    echo "attn.mat_qkv failed"
fi
echo "strict layer -- attn.proj"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "attn.proj"
if [ $? -ne 0 ]; then
    echo "attn.proj failed"
fi
echo "strict layer -- ffn.fc1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "ffn.fc1"
if [ $? -ne 0 ]; then
    echo "ffn.fc1 failed"
fi
echo "strict layer -- ffn.fc2"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "ffn.fc2"
if [ $? -ne 0 ]; then
    echo "ffn.fc2 failed"
fi
echo "strict layer -- ada_lin.1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "ada_lin.1"
if [ $? -ne 0 ]; then
    echo "ada_lin.1 failed"
fi
echo "strict layer -- head"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/img_score_FID.py --cuda_devices "4," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "head"
if [ $? -ne 0 ]; then
    echo "head failed"
fi

echo "fid and is of mix-percision is finished"