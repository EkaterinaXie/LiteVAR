#!/bin/bash

# echo " MODE 0 "
# # echo "Running m0q0"
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 0
# # if [ $? -ne 0 ]; then
# #     echo "m0q0 failed"
# # fi

# echo "m0q0 finished, running m0q1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m0q1 failed"
# fi

# echo "m0q1 finished, running m0q2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 2
# if [ $? -ne 0 ]; then
#     echo "m0q2 failed"
# fi

# echo "m0q2 finished, running m0q3"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m0q3 failed"
# fi

# echo "m0q3 finished, running m0q4"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m0q4 failed"
# fi

# echo "m0q4 finished, running m0q5"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 5
# if [ $? -ne 0 ]; then
#     echo "m0q5 failed"
# fi

# echo "m0q5 finished, running m0q10"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 10
# if [ $? -ne 0 ]; then
#     echo "m0q10 failed"
# fi
# echo "m0q10 finished"


# echo " MODE 1 "
# # echo "Running m1q0"
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 0
# # if [ $? -ne 0 ]; then
# #     echo "m1q0 failed"
# # fi

# echo "m1q0 finished, running m1q1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m1q1 failed"
# fi

# echo "m1q1 finished, running m1q2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 2
# if [ $? -ne 0 ]; then
#     echo "m1q2 failed"
# fi

# echo "m1q2 finished, running m1q3"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m1q3 failed"
# fi

# echo "m1q3 finished, running m1q4"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m1q4 failed"
# fi

# echo "m0q5 finished, running m1q5"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 5
# if [ $? -ne 0 ]; then
#     echo "m1q5 failed"
# fi

# echo "m0q5 finished, running m1q10"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 10
# if [ $? -ne 0 ]; then
#     echo "m1q10 failed"
# fi
# echo "m1q10 finished"
# ########################################
# echo " MODE 2"
# # echo "Running m2q0"
# # python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 0
# # if [ $? -ne 0 ]; then
# #     echo "m2q0 failed"
# # fi

# echo "m2q0 finished, running m2q1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 1
# if [ $? -ne 0 ]; then
#     echo "m2q1 failed"
# fi

# echo "m2q1 finished, running m2q2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 2
# if [ $? -ne 0 ]; then
#     echo "m2q2 failed"
# fi

# echo "m2q2 finished, running m2q3"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 3
# if [ $? -ne 0 ]; then
#     echo "m2q3 failed"
# fi

# echo "m0q5 finished, running m2q4"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 4
# if [ $? -ne 0 ]; then
#     echo "m2q4 failed"
# fi

# echo "m0q5 finished, running m2q5"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 5
# if [ $? -ne 0 ]; then
#     echo "m2q5 failed"
# fi

# echo "m0q5 finished, running m2q10"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 10
# if [ $? -ne 0 ]; then
#     echo "m2q10 failed"
# fi
# echo "m2q10 finished"
# echo "finish all"


################################################################################################################################################################ mix percision
echo "QUANT 1 "
echo "running m0q1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 1
if [ $? -ne 0 ]; then
    echo "m0q1 failed"
fi
echo "running m1q1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 1
if [ $? -ne 0 ]; then
    echo "m1q1 failed"
fi
echo "running m2q1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 1
if [ $? -ne 0 ]; then
    echo "m2q1 failed"
fi


echo "QUANT 3: W6A6"
echo "begin mode 0"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 3
if [ $? -ne 0 ]; then
    echo "m0q3 failed"
fi
echo "begin mode 1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 3
if [ $? -ne 0 ]; then
    echo "m1q3 failed"
fi
echo "begin mode 2"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 3
if [ $? -ne 0 ]; then
    echo "m2q3 failed"
fi


echo "QUANT 4: W4A8"
echo "begin mode 0"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 0 --pic_num 1000 --seed 0 --quant 4
if [ $? -ne 0 ]; then
    echo "m0q4 failed"
fi
echo "begin mode 1"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 1 --pic_num 1000 --seed 0 --quant 4
if [ $? -ne 0 ]; then
    echo "m1q4 failed"
fi
echo "begin mode 2"
python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "5," --model_depth 30 --mode 2 --pic_num 1000 --seed 0 --quant 4
if [ $? -ne 0 ]; then
    echo "m2q4 failed"
fi

echo "sucessfully spilt pic of mix-percision"

################################################################################################################################################################ strict layer

# echo "MODE 0 W8A8 & W4A4"
# echo "strict layer -- word_embed"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "word_embed"
# if [ $? -ne 0 ]; then
#     echo "word_embed failed"
# fi
# echo "strict layer -- attn.mat_qkv"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "attn.mat_qkv"
# if [ $? -ne 0 ]; then
#     echo "attn.mat_qkv failed"
# fi
# echo "strict layer -- attn.proj"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "attn.proj"
# if [ $? -ne 0 ]; then
#     echo "attn.proj failed"
# fi
# echo "strict layer -- ffn.fc1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "ffn.fc1"
# if [ $? -ne 0 ]; then
#     echo "ffn.fc1 failed"
# fi
# echo "strict layer -- ffn.fc2"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "ffn.fc2"
# if [ $? -ne 0 ]; then
#     echo "ffn.fc2 failed"
# fi
# echo "strict layer -- ada_lin.1"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "ada_lin.1"
# if [ $? -ne 0 ]; then
#     echo "ada_lin.1 failed"
# fi
# echo "strict layer -- head"
# python /share/public/diffusion_quant/xierui/pythonprogram/VAR/models/spilt_pic.py --cuda_devices "1," --model_depth 30 --mode 0 --pic_num 250 --seed 0 --quant 1 --strict "head"
# if [ $? -ne 0 ]; then
#     echo "head failed"
# fi

# echo "sucessfully spilt pic of strict layer"